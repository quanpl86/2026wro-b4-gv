# ğŸ“˜ HÆ°á»›ng dáº«n thiáº¿t láº­p Há»‡ thá»‘ng Äiá»u khiá»ƒn Zero-Latency Antigravyti

TÃ i liá»‡u nÃ y hÆ°á»›ng dáº«n chi tiáº¿t tá»« viá»‡c chuáº©n bá»‹ gáº¡ch LEGO EV3 Ä‘áº¿n viá»‡c cáº¥u hÃ¬nh Cloud vÃ  cháº¡y thá»­ nghiá»‡m tÃ­nh nÄƒng Robot Control.

---

## ğŸ—ï¸ 1. Thiáº¿t láº­p Pháº§n cá»©ng (LEGO EV3)

### A. CÃ i Ä‘áº·t Há»‡ Ä‘iá»u hÃ nh (ev3dev)
1. Táº£i image **ev3dev-stretch** táº¡i [ev3dev.org](https://www.ev3dev.org/downloads/).
2. DÃ¹ng **Etcher** Ä‘á»ƒ náº¡p image vÃ o tháº» nhá»› MicroSD (>= 4GB).
3. Cáº¯m tháº» vÃ o EV3, khá»Ÿi Ä‘á»™ng vÃ  káº¿t ná»‘i WiFi trong má»¥c **Wireless and Networks**.
4. Ghi láº¡i Ä‘á»‹a chá»‰ IP cá»§a EV3 (vÃ­ dá»¥: `192.168.0.101`).

### B. Náº¡p mÃ£ nguá»“n Robot
1. Má»Ÿ thÆ° má»¥c `hardware/ev3` báº±ng VS Code.
2. CÃ i extension **"ev3dev-browser"**.
3. Káº¿t ná»‘i vá»›i IP cá»§a EV3 trong tab **EV3 DEVICE BROWSER**.
4. Má»Ÿ file [main.py](file:///Users/mac/Downloads/WRO-GV2026/hardware/ev3/main.py), sá»­a `MQTT_BROKER` thÃ nh **IP mÃ¡y tÃ­nh cá»§a báº¡n**.
5. Nháº¥n **F5** Ä‘á»ƒ táº£i code lÃªn vÃ  cháº¡y. MÃ n hÃ¬nh EV3 hiá»‡n `âœ… Connected!` lÃ  thÃ nh cÃ´ng.

---

## â˜ï¸ 2. Cáº¥u hÃ¬nh Supabase (Cloud Brain)

### A. Táº¡o báº£ng dá»¯ liá»‡u
Cháº¡y lá»‡nh SQL sau trong **SQL Editor** Ä‘á»ƒ táº¡o hÃ ng Ä‘á»£i lá»‡nh:
```sql
create table command_queue (
  id bigint generated by default as identity primary key,
  target text not null,
  command text not null,
  params jsonb default '{}'::jsonb,
  status text default 'pending',
  created_at timestamptz default now()
);
```

### B. Báº­t Realtime (Quan trá»ng nháº¥t)
Äá»ƒ lá»‡nh truyá»n Ä‘i ngay láº­p tá»©c:
1. VÃ o **Database** -> **Publications**.
2. Chá»n hoáº·c táº¡o má»›i publication tÃªn lÃ  **`supabase_realtime`**.
3. Nháº¥n **Edit**, chá»n báº£ng **`command_queue`** vÃ  nháº¥n **Save**.
4. NgoÃ i ra, táº¡i báº£ng `command_queue`, Ä‘áº£m báº£o nÃºt **"Realtime off"** Ä‘Ã£ chuyá»ƒn sang mÃ u xanh **"Realtime on"**.

---

## ğŸ’» 3. Thiáº¿t láº­p MÃ¡y tÃ­nh (AI Brain Bridge)

### A. CÃ i Ä‘áº·t MQTT Broker (Äá»‹a phÆ°Æ¡ng)
Má»Ÿ Terminal vÃ  cháº¡y:
```bash
brew install mosquitto
# Cháº¡y vá»›i cáº¥u hÃ¬nh má»Ÿ (cho phÃ©p EV3 káº¿t ná»‘i)
/usr/local/opt/mosquitto/sbin/mosquitto -c mosquitto_test.conf -d
```

### B. Khá»Ÿi cháº¡y AI Brain Listener
```bash
cd apps/ai-brain
source venv/bin/activate
python command_listener.py
```
*ThÃ´ng bÃ¡o mong Ä‘á»£i:* `ğŸš€ [READY] ÄÃ£ Subscribe Realtime! Robot Ä‘ang láº¯ng nghe lá»‡nh...`

---

## ğŸ•¹ï¸ 4. Quy trÃ¬nh váº­n hÃ nh Control

1. **Má»Ÿ Web:** Truy cáº­p [http://localhost:3000/dashboard/test-control](http://localhost:3000/dashboard/test-control).
2. **Thá»±c hiá»‡n lá»‡nh:** Nháº¥n cÃ¡c nÃºt mÅ©i tÃªn (Tiáº¿n, LÃ¹i, TrÃ¡i, Pháº£i).
3. **DÃ²ng cháº£y dá»¯ liá»‡u:**
   - Web Insert lá»‡nh vÃ o Supabase.
   - Supabase "báº¯n" Websocket ngay láº­p tá»©c tá»›i `command_listener.py`.
   - Python chuyá»ƒn lá»‡nh sang giao thá»©c MQTT.
   - Robot EV3 nháº­n MQTT vÃ  quay motor.
4. **Trá»±c quan hÃ³a:** Báº¡n sáº½ tháº¥y tráº¡ng thÃ¡i lá»‡nh trÃªn Web chuyá»ƒn tá»« `pending` sang `completed` chá»‰ trong nhÃ¡y máº¯t.

---

## ğŸ› ï¸ Xá»­ lÃ½ sá»± cá»‘ (macOS)
- **Lá»—i SSL:** ÄÃ£ Ä‘Æ°á»£c sá»­a tá»± Ä‘á»™ng trong code báº±ng thÆ° viá»‡n `certifi`.
- **Lá»—i EHOSTUNREACH:** Chá»‰nh IPv6 trong System Settings thÃ nh "Link-local only".
- **Lá»—i Delay:** Äáº£m báº£o Ä‘Ã£ báº­t **Replication** trÃªn Supabase cho báº£ng `command_queue`.
